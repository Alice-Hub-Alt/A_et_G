<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone 1.2 : Un Faisceau de Lumière</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            background-image: url('https://c.tenor.com/0IQzAteWlN4AAAAd/tenor.gif');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Press Start 2P', monospace;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.4); 
            background-blend-mode: darken;
        }

        #intro-overlay-zone2 {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: black; 
            display: flex; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        #dialogue-box, #thought-box {
            width: 90%;
            box-sizing: border-box;
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            padding: 20px;
            display: none;
        }

        #dialogue-box {
            height: 20vh;
            background-color: rgba(0,0,0,0.85);
            border: 3px solid white;
        }

        #dialogue-text {
            font-size: 0.8em;
            line-height: 1.5;
            white-space: normal;
            overflow: hidden;
            height: 100%;
        }

        #thought-box {
            background-color: rgba(0,0,0,0.7);
            border: 2px dashed #ff00ff;
            padding: 15px;
            cursor: pointer;
        }

        #thought-text {
            font-size: 0.7em;
            color: #ff00ff;
            line-height:1.5;
        }

        .cursor-active {
            border-right: 0.15em solid white;
            animation: blink-cursor 0.5s step-end infinite;
        }
        @keyframes blink-cursor {
            from, to { border-color: transparent; }
            50% { border-color: white; }
        }

        .conv-screen {
            display: none;
            position: absolute;
            top:50%;
            left:50%;
            transform: translate(-50%, -50%);
            max-width:70%;
            height:auto;
            border:3px solid white;
            opacity:0;
            transition: opacity 1s ease-in-out;
            z-index:20;
            cursor:pointer;
        }
    </style>
</head>

<body>
    <!-- AUDIO -->
    <audio id="zone-audio" loop>
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="type-sound" src="https://dl.dropboxusercontent.com/scl/fi/axdo9itskfifhv6d5d1av/Machine-crire-Bruitage-gratuit-et-libre-Effects-sonores.mp3?rlkey=q1hljzkfdh6b4qjj89yut92oy&st=8d2bqys3&dl=0"></audio>
    <audio id="type-sound-thought" src="https://dl.dropboxusercontent.com/scl/fi/r88xcqkfq22gjne9usnea/phoenix-wright-talking-noise-made-with-Voicemod.mp3?rlkey=cuykwz6lmg1wa21zl0aqljobh&st=u3fz7wy8&dl=0"></audio>

    <!-- OVERLAY -->
    <div id="intro-overlay-zone2">
        Quelques mois plus tard... <br><br> (Cliquer pour continuer)
    </div>

    <!-- BOÎTES -->
    <div id="dialogue-box"><span id="dialogue-text"></span></div>
    <div id="thought-box"><span id="thought-text"></span></div>

    <!-- SCREENS -->
    <img id="screen_a1" class="conv-screen" src="https://i.imgur.com/XA7ud3Z.png" alt="Screen 1 (Evolution)">
    <img id="screen_a2" class="conv-screen" src="https://i.imgur.com/AW3Nnom.png" alt="Screen 2 (Evolution)">
    <img id="screen_a3" class="conv-screen" src="https://i.imgur.com/aValYxk.png" alt="Screen 3 (Evolution)">
    <img id="screen_b1" class="conv-screen" src="https://i.imgur.com/4zgNYwT.png" alt="Screen Soucis">
    <img id="screen_c1" class="conv-screen" src="https://i.imgur.com/3One5eE.png" alt="Screen Condition 1">
    <img id="screen_c2" class="conv-screen" src="https://i.imgur.com/TU3SW7O.png" alt="Screen Condition 2">
    <img id="screen_d1" class="conv-screen" src="https://i.imgur.com/QBa0Hkv.png" alt="Screen Passions 1">
    <img id="screen_d2" class="conv-screen" src="https://i.imgur.com/DAcEnVA.png" alt="Screen Passions 2">
    <img id="screen_d3" class="conv-screen" src="https://i.imgur.com/sjenGQe.png" alt="Screen Passions 3">
    <img id="screen_e1" class="conv-screen" src="https://i.imgur.com/Ll5DcFY.png" alt="Screen Meilleur ami 1">
    <img id="screen_e2" class="conv-screen" src="https://i.imgur.com/Ug7Zv5N.png" alt="Screen Meilleur ami 2">
    <img id="screen_e3" class="conv-screen" src="https://i.imgur.com/4OMCAbt.png" alt="Screen Meilleur ami 3">

    <script>
        // --- Données de la séquence ---
        const dialogueSequence = [
            { text: "Mais au fil du temps, Alice compris.", type: "narrator", action: "dialogue" },
            { text: "Ce n'était pas quelqu'un comme les autres, il avais quelque chose d'unique en lui.", type: "narrator", action: "dialogue" },
            { image: "screen_a1", action: "show_image_click_to_continue" },
            { image: "screen_a2", action: "show_image_click_to_continue" },
            { image: "screen_a3", action: "show_image_click_to_continue" },
            { text: "Il s'intéressais vraiment à elle.", type: "narrator", action: "dialogue" },
            { text: "Et il se souciais d'elle.", type: "narrator", action: "dialogue" },
            { image: "screen_b1", action: "show_image_click_to_continue" },
            { text: "Et il acceptais même ses conditions d'amitié absolument invraisemblable (comme ne jamais se rencontrée, qu'elle ne révèle jamais sa voix, ne montre jamais son visage, ou d'autres trucs objectivement absurde).", type: "narrator", action: "dialogue" },
            { text: "Je rêve ou le narrateur viens de me juger là ?", type: "thought", action: "show_thought" },
            { image: "screen_c1", action: "show_image_click_to_continue" },
            { image: "screen_c2", action: "show_image_click_to_continue" },
            { text: "Petit à Petit, Alice cessa d'être renfermé sur elle même (enfin, en vrais si elle l'était toujours beaucoup, mais pour cette reclus de la société c'était déjà pas mal !)", type: "narrator", action: "dialogue" },
            { text: "(Nan mais chat vas pas ?!!!)", type: "thought", action: "show_thought" },
            { text: "Ils partagèrent les mêmes passions.", type: "narrator", action: "dialogue" },
            { image: "screen_d1", action: "show_image_click_to_continue" },
            { image: "screen_d2", action: "show_image_click_to_continue" },
            { image: "screen_d3", action: "show_image_click_to_continue" },
            { text: "Puis un beau jour, elle cessa d'être seule.", type: "narrator", action: "dialogue" },
            { image: "screen_e1", action: "show_image_click_to_continue" },
            { image: "screen_e2", action: "show_image_click_to_continue" },
            { image: "screen_e3", action: "show_image_click_to_continue" },
            { action: "show_end_button" } // ici le bouton remplace complètement le texte final
        ];

        let currentSequenceIndex = 0;
        let activeImageElement = null;
        let typingInterval;
        let isTyping = false;
        let skipRequested = false;

        const dialogueBox = document.getElementById('dialogue-box');
        const dialogueTextElement = document.getElementById('dialogue-text');
        const thoughtBox = document.getElementById('thought-box');
        const thoughtTextElement = document.getElementById('thought-text');
        const overlay = document.getElementById('intro-overlay-zone2');
        const zoneAudio = document.getElementById('zone-audio');
        const typeSound = document.getElementById('type-sound');
        const typeSoundThought = document.getElementById('type-sound-thought');

        typeSound.volume = 0.5;
        typeSoundThought.volume = 0.5;

        // --- Bouton final ---
        const endButton = document.createElement('button');
        endButton.textContent = "Se sentir aimé";
        endButton.style.padding = "15px 30px";
        endButton.style.fontSize = "1.2em";
        endButton.style.backgroundColor = "#550000";
        endButton.style.color = "white";
        endButton.style.border = "3px solid #ff00ff";
        endButton.style.cursor = "pointer";
        endButton.style.textShadow = "1px 1px 2px black";
        endButton.style.position = "fixed";
        endButton.style.top = "50%";
        endButton.style.left = "50%";
        endButton.style.transform = "translate(-50%, -50%)";
        endButton.style.zIndex = "50";
        endButton.style.display = "none";
        document.body.appendChild(endButton);

        function skipText(e){
            if(isTyping){
                skipRequested = true;
                e.stopPropagation();
            }
        }

        function typeWriter(text, targetElement, isThought, callback){
            if(typingInterval) clearInterval(typingInterval);
            skipRequested = false;
            isTyping = true;
            targetElement.innerHTML = '';
            targetElement.classList.add('cursor-active');

            let soundEl = isThought ? typeSoundThought : typeSound;
            if(soundEl){ soundEl.currentTime=0; soundEl.play().catch(()=>{}); }

            let i=0;
            typingInterval = setInterval(()=>{
                if(skipRequested){
                    targetElement.innerHTML = text;
                    finalizeTyping();
                    return;
                }
                if(i<text.length){
                    targetElement.innerHTML += text.charAt(i++);
                } else {
                    finalizeTyping();
                }
            },28);

            function finalizeTyping(){
                clearInterval(typingInterval);
                targetElement.classList.remove('cursor-active');
                if(soundEl){ soundEl.pause(); soundEl.currentTime=0; }
                isTyping=false;
                if(callback) callback();
            }
        }

        function hideActiveImage(callback){
            if(activeImageElement){
                activeImageElement.style.opacity=0;
                setTimeout(()=>{
                    activeImageElement.style.display='none';
                    activeImageElement=null;
                    if(callback) callback();
                },1000);
            } else if(callback) callback();
        }

        function showImageAndAwaitClick(imageId){
            hideActiveImage(()=>{
                const img=document.getElementById(imageId);
                img.style.display='block';
                activeImageElement=img;
                setTimeout(()=>{
                    img.style.opacity=1;
                    img.addEventListener('click', advanceSequence, {once:true});
                },50);
            });
        }

        function showThought(text){
            hideActiveImage(()=>{
                dialogueBox.style.display='none';
                thoughtBox.style.display='block';
                thoughtBox.addEventListener('click', skipText,false);
                typeWriter(text, thoughtTextElement, true, ()=>{
                    thoughtBox.addEventListener('click', hideThoughtAndContinue, {once:true});
                });
            });
        }

        function hideThoughtAndContinue(){
            if(isTyping) return;
            thoughtBox.style.display='none';
            advanceSequence();
        }

        function advanceSequence(){
            if(isTyping) return;
            dialogueBox.style.display='none';
            thoughtBox.style.display='none';
            if(currentSequenceIndex>=dialogueSequence.length) return;

            const evt=dialogueSequence[currentSequenceIndex++];

            if(evt.action==="dialogue"){
                hideActiveImage(()=>{
                    dialogueBox.style.display='block';
                    dialogueBox.addEventListener('click', skipText,false);
                    typeWriter(evt.text, dialogueTextElement, false, ()=>{
                        dialogueBox.addEventListener('click', advanceSequence, {once:true});
                    });
                });
            } else if(evt.action==="show_thought"){
                showThought(evt.text);
            } else if(evt.action==="show_image_click_to_continue"){
                showImageAndAwaitClick(evt.image);
            } else if(evt.action==="show_end_button"){
                hideActiveImage(()=>{
                    dialogueBox.style.display='none';
                    thoughtBox.style.display='none';
                    endButton.style.display='block';
                    endButton.addEventListener('click', ()=>{
                        zoneAudio.pause();
                        window.location.href='zone2.html';
                    }, {once:true});
                });
            }
        }

        overlay.addEventListener('click', ()=>{
            overlay.style.display='none';
            zoneAudio.play().catch(()=>{});
            advanceSequence();
        }, {once:true});
    </script>
</body>
</html>
