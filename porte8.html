<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Porte 8</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

html, body{
  margin:0; padding:0; height:100%;
  font-family:'Press Start 2P', monospace;
  overflow:hidden;
  background:url('https://c.tenor.com/f4GKnTi51DwAAAAd/tenor.gif') center/cover no-repeat;
}

/* Ordi cliquable */
#book-btn{
  position:fixed;
  left:50%;
  bottom:22px;
  transform:translateX(-50%);
  width:320px;
  height:auto;
  cursor:pointer;
  image-rendering:pixelated;
  transition:transform .18s;
  z-index:10;
}
#book-btn:hover { transform: translateX(-50%) scale(1.05); }

/* Dialogue */
#dialogue-box{
  position:fixed;
  left:50%; bottom:26px;
  transform:translateX(-50%);
  width:84%;
  min-height:14vh; max-height:28vh;
  background:rgba(0,0,0,0.8);
  border:3px solid #ff00ff;
  padding:18px;
  color:#ff66ff;
  display:none;
  z-index:9000;
  text-shadow:0 0 6px rgba(255,0,255,0.2);
  overflow:auto;
  cursor: pointer;
}
#dialogue-text{ font-size:0.86em; line-height:1.45; }
.cursor-active{
  border-right:0.15em solid #ff66ff;
  animation:blink 0.5s steps(1) infinite;
  padding-right:6px;
}
@keyframes blink{
  0%,100%{border-color:transparent;}
  50%{border-color:#ff66ff;}
}

/* Retour */
#back-btn{
  position:fixed; top:14px; left:14px;
  font-size:32px; color:red;
  cursor:pointer; z-index:6000;
  text-shadow: 2px 2px 0px black;
}

/* Visionneuse */
#viewer-container{
  position:fixed; top:50%; left:50%;
  transform:translate(-50%, -50%);
  display:none;
  z-index:5000;
  width: 80%;
  text-align: center;
}

/* Zone cliquable pour fermer */
#viewer-bg-block{
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  display:none;
  z-index:4000;
}

/* Image de la visionneuse */
#viewer-img{
  display:block;
  max-width:100%;
  max-height:80vh;
  margin:0 auto;
  border: 4px solid white;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

/* Flèche suivante */
#next-arrow{
  position:absolute;
  right:-50px;
  top:50%;
  transform:translateY(-50%);
  font-size:42px;
  color:red;
  cursor:pointer;
  z-index:5001;
  text-shadow: 2px 2px 0px black;
}
</style>
</head>

<body>

<audio id="puzzle-music" loop autoplay>
    <source src="https://www.dropbox.com/scl/fi/4l93s3wshbq5pqx9u1azk/Code-Lyoko-The-Hermitange.mp3?dl=1" type="audio/mpeg">
</audio>

<div id="dialogue-box"><div id="dialogue-text"></div></div>
<div id="back-btn" onclick="location.href='zone2_1.html'">⬅</div>

<img id="book-btn" src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExYjYzY2ZmbWx2aXk2MGo2NjBnZjQyMHZiYzI2Y2k5dzUxM3cwdG9obSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/ao9DUiTKH60XS/giphy.gif" alt="Livre/Ordi">

<div id="viewer-bg-block"></div>

<div id="viewer-container">
  <img id="viewer-img" src="">
  <div id="next-arrow">➡</div>
</div>

<audio id="type-sound" src="https://dl.dropboxusercontent.com/scl/fi/r88xcqkfq22gjne9usnea/phoenix-wright-talking-noise-made-with-Voicemod.mp3?rlkey=cuykwz6lmg1wa21zl0aqljobh&dl=1"></audio>

<script>
const music = document.getElementById("puzzle-music");
const dialogueBox = document.getElementById("dialogue-box");
const dialogueText = document.getElementById("dialogue-text");
const typeSound = document.getElementById("type-sound");

let isTyping=false, skip=false;

function stopSound(){
  try{ typeSound.pause(); typeSound.currentTime=0; }catch(e){}
}

function typeWriter(text){
  if(isTyping) return;
  skip=false;
  isTyping=true;
  dialogueText.innerHTML="";
  dialogueBox.style.display="block";
  dialogueText.classList.add("cursor-active");
  try{ typeSound.play().catch(()=>{});}catch(e){}
  let i=0;
  let interval=setInterval(()=>{
    if(skip){
      dialogueText.innerHTML=text;
      clearInterval(interval);
      dialogueText.classList.remove("cursor-active");
      stopSound();
      isTyping=false;
      return;
    }
    if(i<text.length){
      dialogueText.innerHTML+=text.charAt(i++);
    } else {
      clearInterval(interval);
      dialogueText.classList.remove("cursor-active");
      stopSound();
      isTyping=false;
    }
  },28);
}

let postViewerStep = 0;

dialogueBox.addEventListener("click", ()=>{
  if(isTyping){
    skip = true;
    return;
  }
  dialogueBox.style.display = "none";

  if(postViewerStep === 1){
    postViewerStep = 2;
    typeWriter("Je vais pas trainer quand même au moindre cour circuit et je suis électrocuter !");
  }
});

window.onload = ()=>{
  // Tentative de lecture auto
  music.play().catch(() => {
    console.log("Lecture auto bloquée par le navigateur.");
  });

  typeWriter("Belle pleine lune ! Si seulement j'était une louve garrou...");
}

/* Visionneuse */
const viewer = document.getElementById("viewer-container");
const viewerBlock = document.getElementById("viewer-bg-block");
const viewerImg = document.getElementById("viewer-img");
const nextArrow = document.getElementById("next-arrow");

const images=[
  "https://i.imgur.com/3vqFlll.png",
  "https://i.imgur.com/fLdYVq3.png",
  "https://i.imgur.com/zfOM1CM.png",
  "https://i.imgur.com/sCchwcE.png"
];

let index=0;

document.getElementById("book-btn").addEventListener("click", ()=>{
  if(viewer.style.display === "block") return;
  typeWriter("Mais, il est dans de l'eau c'est completement con ! Comment y peux fonctionner...?");
  index=0;
  openViewer();
});

function refreshViewer(){ viewerImg.src = images[index]; }

function openViewer(){
  refreshViewer();
  viewer.style.display="block";
  viewerBlock.style.display="block";
}

function closeViewer(){
  viewer.style.display="none";
  viewerBlock.style.display="none";

  if(postViewerStep === 0){
    postViewerStep = 1;
    typeWriter("Bon... Il a pas explosé...");
  }
}

nextArrow.addEventListener("click", (e)=>{
  e.stopPropagation();
  index=(index+1)%images.length;
  refreshViewer();
});

viewerBlock.addEventListener("click", closeViewer);
</script>

</body>
</html>
