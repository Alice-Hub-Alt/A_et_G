<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zone 2_1 : Le Labyrinthe de la Connexion</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  :root{
    --pink:#ff66ff;
    --pink-strong:#b300ff;
  }

  html, body {
    margin:0;
    height:100%;
  }

  body {
    background-image: url('https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2tmam1wYzlkYzRpZzR3cmt3Mno4MGdrYmkwaDZpcmpzYTc5azdnNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/NANml9RASmTDU9tA5s/giphy.gif');
    background-size: cover;
    background-repeat:no-repeat;
    background-attachment: fixed;
    background-position: center;
    font-family: 'Press Start 2P';
    color:white;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:default;
  }

  /* TOOLTIP */
  .door-wrapper {
    position:absolute;
  }

  .tooltip {
    position:absolute;
    top:-32px;
    left:50%;
    transform:translateX(-50%);
    background:#000;
    padding:6px 12px;
    font-size:0.72em;
    color:white;
    white-space:nowrap;
    border:2px solid currentColor;
    opacity:0;
    pointer-events:none;
    transition:opacity .18s;
  }

  .door-wrapper:hover .tooltip {
    opacity:1;
  }

  /* DIALOGUE */
  #dialogue-box {
    position:fixed;
    bottom:28px;
    left:50%;
    transform:translateX(-50%);
    width:84%;
    min-height:14vh;
    max-height:30vh;
    background:black;
    border:3px solid var(--pink-strong);
    padding:18px;
    box-sizing:border-box;
    z-index:9000;
    color:var(--pink);
    display:none;
    text-shadow:0 0 6px rgba(255,0,255,0.3);
    overflow:auto;
  }

  #dialogue-text {
    font-size:0.86em;
    line-height:1.45;
  }

  .cursor-active {
    border-right:0.15em solid var(--pink);
    animation:blink 0.5s steps(1) infinite;
    padding-right:6px;
  }

  @keyframes blink {
    0%,100%{ border-color:transparent; }
    50%{ border-color:var(--pink); }
  }

  /* PORTES */
  .clickable-door {
    height:200px;
    cursor:pointer;
    image-rendering:pixelated;
    transition:transform .18s;
    z-index:100;
    user-select:none;
  }

  .clickable-door:hover {
    transform:scale(1.06);
  }

  /* SORTIE */
  #door-exit {
    height:460px;
  }

  .exit-container {
    position:absolute;
    left:50%;
    top:28%;
    transform:translateX(-50%);
  }

  /* CHOIX : ENTRER / INSPECTER */
  #choice-box {
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:black;
    padding:18px;
    display:none;
    justify-content:center;
    gap:48px;
    z-index:9999;
    border-top:3px solid white;
  }

  .choice-btn {
    font-family:'Press Start 2P';
    font-size:0.8em;
    color:white;
    background:black;
    border:2px solid white;
    padding:14px 22px;
    cursor:pointer;
  }

  .choice-btn:hover {
    background:white;
    color:black;
  }

  /* AUTRES PORTES */
  #door-1{ left:20%; top:5%; }
  #door-2{ left:10%; top:25%; }
  #door-3{ left:10%; top:50%; }
  #door-4{ left:20%; top:70%; }
  #door-5{ right:20%; top:5%; }
  #door-6{ right:10%; top:25%; }
  #door-7{ right:10%; top:50%; }
  #door-8{ right:20%; top:70%; }

  @media (max-height:700px){
    .clickable-door{ height:150px; }
    #door-exit{ height:360px; }
  }

  @media (max-width:600px){
    .clickable-door{ height:120px; }
    #door-exit{ height:300px; }
    .exit-container{ top:22%; }
    #dialogue-box{ width:92%; }
  }
</style>
</head>
<body>

  <audio id="zone-audio" loop>
    <source src="votre_lien_audio_zone2.mp3" type="audio/mpeg">
  </audio>

  <audio id="type-sound"
    src="https://dl.dropboxusercontent.com/scl/fi/r88xcqkfq22gjne9usnea/phoenix-wright-talking-noise-made-with-Voicemod.mp3?rlkey=cuykwz6lmg1wa21zl0aqljobh&st=u3fz7wy8&dl=0">
  </audio>

  <div id="dialogue-box"><div id="dialogue-text"></div></div>

  <!-- CHOIX -->
  <div id="choice-box">
    <button id="btn-enter" class="choice-btn">Entrer</button>
    <button id="btn-inspect" class="choice-btn">Inspecter</button>
  </div>

  <!-- SORTIE -->
  <div class="door-wrapper exit-container">
    <div class="tooltip" style="color:white;">Sortie ?</div>
    <img id="door-exit" class="clickable-door" src="https://i.imgur.com/7xp8PkZ.png">
  </div>

  <!-- PORTES -->
  <div class="door-wrapper" style="left:20%; top:5%;">
    <div class="tooltip" style="color:#b300ff;">Porte 1</div>
    <img id="door-1" class="clickable-door" src="https://i.imgur.com/OSOCKnQ.png">
  </div>

  <div class="door-wrapper" style="left:10%; top:25%;">
    <div class="tooltip" style="color:#0058ff;">Porte 2</div>
    <img id="door-2" class="clickable-door" src="https://i.imgur.com/mTg0Zm6.png">
  </div>

  <div class="door-wrapper" style="left:10%; top:50%;">
    <div class="tooltip" style="color:#b300ff;">Porte 3</div>
    <img id="door-3" class="clickable-door" src="https://i.imgur.com/WKgSmFP.png">
  </div>

  <div class="door-wrapper" style="left:20%; top:70%;">
    <div class="tooltip" style="color:#0058ff;">Porte 4</div>
    <img id="door-4" class="clickable-door" src="https://i.imgur.com/HY94Buw.png">
  </div>

  <div class="door-wrapper" style="right:20%; top:5%;">
    <div class="tooltip" style="color:#b300ff;">Porte 5</div>
    <img id="door-5" class="clickable-door" src="https://i.imgur.com/gQgJFUN.png">
  </div>

  <div class="door-wrapper" style="right:10%; top:25%;">
    <div class="tooltip" style="color:#0058ff;">Porte 6</div>
    <img id="door-6" class="clickable-door" src="https://i.imgur.com/7vIHXUp.png">
  </div>

  <div class="door-wrapper" style="right:10%; top:50%;">
    <div class="tooltip" style="color:#b300ff;">Porte 7</div>
    <img id="door-7" class="clickable-door" src="https://i.imgur.com/qmbKHzv.png">
  </div>

  <div class="door-wrapper" style="right:20%; top:70%;">
    <div class="tooltip" style="color:#0058ff;">Porte 8</div>
    <img id="door-8" class="clickable-door" src="https://i.imgur.com/xzZ06bS.png">
  </div>

<script>
const dialogueBox=document.getElementById('dialogue-box');
const dialogueTextElement=document.getElementById('dialogue-text');
const choiceBox=document.getElementById('choice-box');
const btnEnter=document.getElementById('btn-enter');
const btnInspect=document.getElementById('btn-inspect');
const typeSound=document.getElementById('type-sound');
const zoneAudio=document.getElementById('zone-audio');

let currentDoor=null;

let typingInterval=null;
let isTyping=false;
let skipRequested=false;

function stopTypeSound(){ try{ typeSound.pause(); typeSound.currentTime=0;}catch(e){} }
function skipHandler(e){ if(isTyping){ skipRequested=true; e.stopPropagation(); } }

function typeWriter(text,target,onFinish){
  if(typingInterval) clearInterval(typingInterval);
  skipRequested=false;
  isTyping=true;
  target.innerHTML="";
  target.classList.add('cursor-active');
  try{ typeSound.currentTime=0; typeSound.play().catch(()=>{});}catch(e){}
  let i=0;
  typingInterval=setInterval(()=>{
    if(skipRequested){
      target.innerHTML=text;
      clearInterval(typingInterval);
      stopTypeSound();
      target.classList.remove('cursor-active');
      isTyping=false;
      if(onFinish) onFinish();
      return;
    }
    if(i<text.length){
      target.innerHTML+=text.charAt(i++);
    } else {
      clearInterval(typingInterval);
      stopTypeSound();
      target.classList.remove('cursor-active');
      isTyping=false;
      if(onFinish) onFinish();
    }
  },28);
}

function showMessage(msg,callback){
  if(isTyping) return;
  dialogueBox.style.display="block";
  dialogueBox.addEventListener('click',skipHandler,false);
  typeWriter(msg,dialogueTextElement,()=>{
    dialogueBox.addEventListener('click',()=>{
      dialogueBox.style.display="none";
      stopTypeSound();
      if(callback) callback();
    },{once:true});
  });
}

/* Clic sur une porte */
document.querySelectorAll('.clickable-door').forEach(el=>{
  el.addEventListener('click',()=>{
    if(el.id==='door-exit'){
      showMessage("Mince, la sortie est vraiment bloquée.",()=>{
        showMessage("Je devrais peut-être explorer, peut-être que je trouverais une autre issue, ou un moyen d'ouvrir ce cadenas chelou.");
      });
      return;
    }

    currentDoor=el.id.replace('door-','');

    choiceBox.style.display="flex";
  });
});

/* Bouton ENTRER */
btnEnter.addEventListener('click',()=>{
  if(!currentDoor) return;
  window.location.href=`porte${currentDoor}.html`;
});

/* Bouton INSPECTER */
btnInspect.addEventListener('click',()=>{
  if(!currentDoor) return;

  choiceBox.style.display="none";

  let msg2="[inséré plus tard]";

  if(currentDoor==="1"){
    msg2="Quelle est la relique dont j'ai le plus aimer faire don ?";
  }
  if(currentDoor==="8"){
    msg2="Quelle est l'héritage dont il a le plus chéri la transmission ?";
  }

  showMessage("Je vois une inscription sur la poignée.",()=>{
    showMessage(msg2);
  });
});

/* Code secret */
document.addEventListener('DOMContentLoaded',()=>{
  const seq=[40,39,38,37,38,37,40,39];
  let index=0;
  document.addEventListener('keydown',e=>{
    if(e.keyCode===seq[index]){
      index++;
      if(index===seq.length){
        alert("Code ACCEPTÉ. Une faille s'ouvre dans la réalité...");
        window.location.href='secret_code.html';
        index=0;
      }
    } else index=0;
  });
});
</script>

</body>
</html>
