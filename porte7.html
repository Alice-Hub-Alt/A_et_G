<!DOCTYPE html>

<html lang="fr">

<head>

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Porte 7 - Rune GA (Finale)</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

html, body{
    margin:0; padding:0; height:100%;
    font-family:'Press Start 2P', monospace;
    overflow:hidden;
    background:url('https://i.redd.it/5oqqs8imr6s41.gif') center/cover no-repeat;
    user-select: none;
}

#back-btn{
    position:fixed; top:14px; left:14px;
    font-size:32px; color:red;
    cursor:pointer; z-index:6000;
    text-shadow: 2px 2px 0px black;
}

#dialogue-box{
    position:fixed;
    left:50%; bottom:26px;
    transform:translateX(-50%);
    width:84%;
    min-height:14vh; max-height:28vh;
    background:rgba(0,0,0,0.55);
    border:3px solid #ff00ff;
    padding:18px;
    color:#ff66ff;
    display:none;
    z-index:9000;
    overflow:auto;
}

#dialogue-text{ font-size:0.86em; line-height:1.45; }

#puzzle-container {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 100;
    text-align: center;
}

#canvas-wrapper {
    position: relative;
    border: 4px solid white;
    display: inline-block;
    width: 400px;
    height: 360px;
}

#rune-canvas {
    background-color: rgba(0, 0, 0, 0.8);
    display: block;
}

.connection-point {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transform: translate(-50%, -50%);
}

.connection-point.selected {
    background-color: #ff00ff;
    border: 2px solid white;
}

#validate-btn {
    position: fixed;
    bottom: 20%;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px;
    font-family: 'Press Start 2P', monospace;
    background: black;
    color: white;
    border: 3px solid white;
    cursor: pointer;
}

#win-image-container {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    display: none;
}
</style>

</head>

<body>

<div id="back-btn">⬅</div>

<div id="puzzle-container">
    <div style="color:#ff00ff;">Tracez notre Symbole : La Rune GA</div>
    <div id="canvas-wrapper">
        <canvas id="rune-canvas" width="400" height="360"></canvas>
    </div>
</div>

<button id="validate-btn">VALIDER</button>

<div id="win-image-container">
    <img src="https://i.imgur.com/xnhXVcZ.png">
</div>

<script>
const canvas = document.getElementById('rune-canvas');
const ctx = canvas.getContext('2d');
const wrapper = document.getElementById('canvas-wrapper');
const btnValidate = document.getElementById('validate-btn');
const winContainer = document.getElementById('win-image-container');

const GRID_COLS = 10;
const GRID_ROWS = 9;
const SPACING = 40;
const START_OFFSET = SPACING / 2;

let POINTS_CONFIG = [];
let pointCounter = 1;

for (let y = 0; y < GRID_ROWS; y++) {
    for (let x = 0; x < GRID_COLS; x++) {
        POINTS_CONFIG.push({
            id: `P${pointCounter}`,
            x: START_OFFSET + x * SPACING,
            y: START_OFFSET + y * SPACING
        });
        pointCounter++;
    }
}

/* ✅ SEULE PARTIE MODIFIÉE */
const SOLUTION_LINES = [
    'P23_P43',
    'P5_P23',
    'P5_P27',
    'P27_P35',
    'P35_P45',
    'P43_P48',
    'P53_P73',
    'P55_P67',
    'P55_P85'
];

let currentLines = new Map();
let selectedPoint = null;

function getLineKey(a, b){ return [a, b].sort().join('_'); }
function getPointById(id){ return POINTS_CONFIG.find(p => p.id === id); }

function drawCanvas(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 4;
    currentLines.forEach(l=>{
        ctx.beginPath();
        ctx.moveTo(l.x1,l.y1);
        ctx.lineTo(l.x2,l.y2);
        ctx.stroke();
    });
}

function handlePointClick(){
    const id = this.id;
    if(!selectedPoint){
        selectedPoint = id;
        this.classList.add('selected');
    } else {
        const key = getLineKey(selectedPoint,id);
        if(currentLines.has(key)){
            currentLines.delete(key);
        } else {
            const a = getPointById(selectedPoint);
            const b = getPointById(id);
            currentLines.set(key,{x1:a.x,y1:a.y,x2:b.x,y2:b.y});
        }
        document.getElementById(selectedPoint).classList.remove('selected');
        selectedPoint = null;
        drawCanvas();
    }
}

POINTS_CONFIG.forEach(p=>{
    const d=document.createElement('div');
    d.className='connection-point';
    d.id=p.id;
    d.style.left=p.x+'px';
    d.style.top=p.y+'px';
    d.onclick=handlePointClick;
    wrapper.appendChild(d);
});

btnValidate.onclick=()=>{
    const u=[...currentLines.keys()].sort();
    const s=[...SOLUTION_LINES].sort();
    if(u.length===s.length && u.every((v,i)=>v===s[i])){
        winContainer.style.display='block';
    } else {
        alert("Raté.");
    }
};
</script>

</body>
</html>
