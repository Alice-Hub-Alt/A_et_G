<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Porte 7</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Press Start 2P', monospace;
    overflow: hidden;
    background: url('https://64.media.tumblr.com/6720afe4b23fff20fb0a55a8733db945/147bfebdf112f180-c6/s400x600/b6f51cddbdd98ddab9e322b88807158dac343608.gifv') center/cover no-repeat;
    color: white;
    user-select: none;
}

#back-btn {
    position: fixed; top: 14px; left: 14px;
    font-size: 32px; color: red;
    cursor: pointer; z-index: 20000; /* Priorité absolue pour rester cliquable */
    text-shadow: 2px 2px 0px black;
}

/* --- SCÈNE DE COMBAT --- */
#battle-scene {
    position: fixed; top: 5%; left: 50%;
    transform: translateX(-50%);
    width: 90%; max-width: 600px;
    height: 45%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 5;
}

#enemy-container {
    position: relative;
    text-align: center;
    animation: float 4s ease-in-out infinite;
}
#enemy-img {
    width: 250px; height: auto;
    filter: drop-shadow(0 0 10px rgba(255,0,0,0.5));
}
#enemy-name {
    margin-top: 10px; color: red; font-size: 0.8em; text-shadow: 2px 2px black;
}

@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

/* EFFETS VISUELS */
.fx-overlay {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none; display: none; z-index: 10;
}
#player-attack-fx { width: 200px; } 
#summon-fx { width: 300px; mix-blend-mode: screen; transform: translate(-50%, -60%); } 
#enemy-attack-fx {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    object-fit: cover; transform: none; z-index: 100; mix-blend-mode: screen;
}

/* --- HUD --- */
#hud {
    position: fixed; top: 52%; left: 50%;
    transform: translateX(-50%);
    width: 90%; max-width: 600px;
    display: flex; justify-content: space-between;
    font-size: 0.8em; z-index: 20;
}
.status-box { background: rgba(0,0,255,0.4); border: 2px solid white; padding: 10px; width: 45%; text-shadow: 1px 1px black; }
.enemy-status { background: rgba(255,0,0,0.4); text-align: right; }

/* --- MENU --- */
#action-menu {
    position: fixed; bottom: 20px; left: 50%;
    transform: translateX(-50%);
    width: 90%; max-width: 600px; height: 150px;
    background: rgba(0,0,0,0.9); border: 4px solid white; border-radius: 10px;
    display: grid; grid-template-columns: 1fr 1fr; padding: 10px; gap: 10px;
    z-index: 20;
}
.btn-action {
    background: none; border: 2px solid #555; color: white;
    font-family: 'Press Start 2P', monospace; font-size: 0.9em;
    cursor: pointer; text-align: left; padding-left: 20px; transition: 0.2s;
}
.btn-action:hover:not([disabled]) { background: white; color: black; border-color: white; }
.btn-action[disabled] { opacity: 0.5; cursor: not-allowed; }

#log-box {
    position: fixed; bottom: 180px; left: 50%;
    transform: translateX(-50%);
    width: 90%; max-width: 600px;
    background: rgba(0,0,0,0.8); border: 2px solid #777;
    padding: 10px; color: #aaa; font-size: 0.7em; min-height: 40px;
    display: flex; align-items: center; z-index: 20;
}

#summon-menu {
    display: none; position: absolute; top: 0; left: 0;
    width: 100%; height: 100%; background: #222; z-index: 30;
    flex-direction: column;
}

/* VICTOIRE */
#win-screen {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); 
    display: none; z-index: 15000; /* En dessous du back-btn */
    flex-direction: column; align-items: center; justify-content: center;
}
#win-img { max-width: 90vw; max-height: 70vh; margin-bottom: 20px;}

/* DIALOGUE */
#dialogue-box {
    position: fixed; left: 50%; bottom: 26px; transform: translateX(-50%);
    width: 84%; min-height: 100px; background: rgba(0,0,0,0.9);
    border: 3px solid #ff00ff; padding: 18px; color: #ff66ff;
    display: none; z-index: 25000; font-size: 0.8em; line-height: 1.5;
}
</style>
</head>
<body>

<audio id="type-sound" src="https://dl.dropboxusercontent.com/scl/fi/r88xcqkfq22gjne9usnea/phoenix-wright-talking-noise-made-with-Voicemod.mp3?rlkey=cuykwz6lmg1wa21zl0aqljobh&dl=1"></audio>
<audio id="sword-sound" src="https://dl.dropboxusercontent.com/scl/fi/0s9a907ztk60i2vl2c6t1/armor-impact-from-sword-393843.mp3?rlkey=ejusp7vuuok6b3gtsux4dgasu&dl=1"></audio>
<audio id="explosion-sound" src="https://dl.dropboxusercontent.com/scl/fi/u4n1qmbf26hf8c2nee34m/explosion-312361.mp3?rlkey=f7aszoih15us4lid8mmk7r107&dl=1"></audio>
<audio id="summon-sound" src="https://dl.dropboxusercontent.com/scl/fi/1zgbvmqx0is149a94vfxl/sfx-cinematic-and-magical-riser-sound-effect-373215.mp3?rlkey=3cuiylc08201ci77ex3djial1&dl=1"></audio>
<audio id="death-sound" src="https://dl.dropboxusercontent.com/scl/fi/p7ls5b1kq4di28wvt7nar/half-life-gmod-death-sound-high-quality.mp3?rlkey=8igo29z5228x3uxofcxedye6h&dl=1"></audio>

<div id="back-btn" onclick="location.href='zone2_1.html'">⬅</div>

<div id="battle-scene">
    <div id="enemy-container">
        <img id="enemy-img" src="https://i.imgur.com/sW9pbd3.png" alt="Réalité">
        <div id="enemy-name">RÉALITÉ</div>
        <img id="player-attack-fx" class="fx-overlay" src="https://cdn.pixabay.com/animation/2025/10/26/17/49/17-49-35-844_512.gif">
        <img id="summon-fx" class="fx-overlay" src="https://img.itch.zone/aW1hZ2UvMjgxOTU5LzEzNjk3MDYuZ2lm/original/YaPnLG.gif">
    </div>
</div>

<img id="enemy-attack-fx" class="fx-overlay" src="https://cdna.artstation.com/p/assets/images/images/047/076/748/original/yuri-rodrigues-explosion-visualize.gif?1646703473">

<div id="hud">
    <div class="status-box enemy-status">RÉALITÉ<br>HP: ∞</div>
    <div class="status-box">ALICE<br>HP: <span id="player-hp">100</span> / 100</div>
</div>

<div id="log-box">La Réalité vous oppresse. À vous.</div>

<div id="action-menu">
    <button class="btn-action" onclick="playerAction('attack')">ATTAQUER</button>
    <button class="btn-action" onclick="playerAction('defend')">DÉFENDRE</button>
    <button class="btn-action" onclick="openSummon()">APPELER</button>
    <button class="btn-action" onclick="playerAction('flee')">FUIR</button>

    <div id="summon-menu">
        <button class="btn-action" style="height:100%; text-align:center; color:#ff00ff;" onclick="summonGuilian()">> GUILIAN</button>
        <button class="btn-action" style="height:100%; text-align:center; font-size:0.6em; color:#555;" onclick="closeSummon()">RETOUR</button>
    </div>
</div>

<div id="win-screen">
    <img id="win-img" src="https://i.imgur.com/Uyh6gqF.png" alt="Victoire">
</div>

<div id="dialogue-box"></div>

<script>
const dialogueBox = document.getElementById("dialogue-box");
let typeInterval;
const dialogs = {
    intro: ["Oh un RPG ! Mais attend...? Contre la réalité ?!", "Mais je vais jamais gagner !"],
    attack: "Ah ouai, la baggare c'est pas mon fort on dirais !",
    defend: "Completement inutile !",
    flee: "Je suis bête on est dans ma tête je peux pas fuir !",
    win: "Et ben ! Heureusement qu'il est là je serait morte sans lui !"
};

function playSound(id) {
    const sound = document.getElementById(id);
    if(sound) { sound.currentTime = 0; sound.play().catch(()=>{}); }
}

function showDialogue(text, callback = null) {
    clearInterval(typeInterval); dialogueBox.style.display = 'block'; dialogueBox.innerHTML = ''; 
    playSound('type-sound');
    let i = 0; let currentText = "";
    dialogueBox.onclick = () => { clearInterval(typeInterval); dialogueBox.innerHTML = text; finish(); };
    function finish() {
        try { document.getElementById('type-sound').pause(); } catch(e){}
        dialogueBox.onclick = () => { dialogueBox.style.display = 'none'; if (callback) callback(); };
    }
    typeInterval = setInterval(() => { currentText += text.charAt(i); dialogueBox.innerHTML = currentText; i++; if (i >= text.length) { clearInterval(typeInterval); finish(); } }, 30);
}

let playerHP = 100;
let isPlayerTurn = true;
const logBox = document.getElementById('log-box');
const hpSpan = document.getElementById('player-hp');
const menuBtns = document.querySelectorAll('#action-menu > .btn-action');

window.onload = () => {
    showDialogue(dialogs.intro[0], () => setTimeout(() => showDialogue(dialogs.intro[1]), 200));
};

function setTurn(player) {
    isPlayerTurn = player;
    menuBtns.forEach(btn => btn.disabled = !player);
    if (!player) setTimeout(enemyAttack, 1000);
    logBox.innerText = player ? "C'est à vous." : "La Réalité prépare quelque chose...";
}

function playerAction(action) {
    if (!isPlayerTurn) return;
    closeSummon();
    if (action === 'attack') {
        logBox.innerText = "Alice attaque ! 1 Dégât...";
        playFx('player-attack-fx', 'sword-sound', 1000);
        showDialogue(dialogs.attack, () => setTurn(false));
    } else if (action === 'defend') {
        logBox.innerText = "Alice se protège.";
        showDialogue(dialogs.defend, () => setTurn(false));
    } else if (action === 'flee') {
        logBox.innerText = "Fuite impossible.";
        showDialogue(dialogs.flee, () => setTurn(false));
    }
}

function openSummon() { if(isPlayerTurn) document.getElementById('summon-menu').style.display = 'flex'; }
function closeSummon() { document.getElementById('summon-menu').style.display = 'none'; }

function enemyAttack() {
    document.getElementById('hud').style.display = 'none';
    document.getElementById('action-menu').style.display = 'none';
    logBox.style.display = 'none';
    playSound('explosion-sound');
    const explosion = document.getElementById('enemy-attack-fx');
    explosion.style.display = 'block';

    setTimeout(() => {
        explosion.style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        document.getElementById('action-menu').style.display = 'grid';
        logBox.style.display = 'flex';
        playerHP -= 99;
        hpSpan.innerText = playerHP;
        logBox.innerText = "La Réalité vous frappe de plein fouet ! -99 PV !";
        logBox.style.color = "red";
        checkDeath();
    }, 1200);
}

function checkDeath() {
    if (playerHP <= 0) {
        hpSpan.innerText = "0";
        playSound('death-sound');
        setTimeout(() => { location.href = 'zone2_1.html'; }, 3000);
    } else {
        setTimeout(() => { logBox.style.color = "#aaa"; setTurn(true); }, 2000);
    }
}

function summonGuilian() {
    if (!isPlayerTurn) return;
    document.getElementById('summon-menu').style.display = 'none';
    document.getElementById('action-menu').style.display = 'none';
    document.getElementById('hud').style.display = 'none';
    logBox.style.display = 'none';
    playFx('summon-fx', 'summon-sound', 2000);

    setTimeout(() => {
        document.getElementById('enemy-container').style.display = 'none';
        document.getElementById('win-screen').style.display = 'flex';
        showDialogue(dialogs.win);
    }, 2000);
}

function playFx(imgId, soundId, duration) {
    const fx = document.getElementById(imgId);
    fx.style.display = 'block';
    playSound(soundId);
    setTimeout(() => fx.style.display = 'none', duration);
}
</script>
</body>
</html>
