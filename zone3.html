<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone 1.2 : Un Faisceau de Lumière</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            background-image: url('https://c.tenor.com/0IQzAteWlN4AAAAd/tenor.gif');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Press Start 2P', monospace;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.4);
            background-blend-mode: darken;
        }

        #intro-overlay-zone2 {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: black;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        #dialogue-box, #thought-box {
            width: 90%;
            box-sizing: border-box;
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            padding: 20px;
            display: none;
        }

        #dialogue-box {
            height: 20vh;
            background-color: rgba(0,0,0,0.85);
            border: 3px solid white;
        }

        #dialogue-text {
            font-size: 0.8em;
            line-height: 1.5;
            white-space: normal;
            overflow: hidden;
            height: 100%;
        }

        #thought-box {
            background-color: rgba(0,0,0,0.7);
            border: 2px dashed #ff00ff;
            padding: 15px;
            cursor: pointer;
        }

        #thought-text {
            font-size: 0.7em;
            color: #ff00ff;
            line-height:1.5;
        }

        .cursor-active {
            border-right: 0.15em solid white;
            animation: blink-cursor 0.5s step-end infinite;
        }
        @keyframes blink-cursor {
            from, to { border-color: transparent; }
            50% { border-color: white; }
        }

        .conv-screen {
            display: none;
            position: absolute;
            top:50%;
            left:50%;
            transform: translate(-50%, -50%);
            max-width:70%;
            height:auto;
            border:3px solid white;
            opacity:0;
            transition: opacity 1s ease-in-out;
            z-index:20;
            cursor:pointer;
        }

        .floating-gif {
            position: absolute;
            width: 220px;
            height: 220px;
            pointer-events: none;
            z-index: 5;
        }

        #end-button {
            position: fixed;
            top:50%;
            left:50%;
            transform: translate(-50%, -50%);
            background:black;
            color:white;
            border:2px solid white;
            font-size:1.4em;
            padding:15px 40px;
            display:none;
            cursor:pointer;
            z-index:2000;
        }
    </style>
</head>

<body>

    <audio id="zone-audio" loop></audio>

    <div id="intro-overlay-zone2">
        Quelques mois plus tard... <br><br> (Cliquer pour continuer)
    </div>

    <div id="dialogue-box"><span id="dialogue-text"></span></div>
    <div id="thought-box"><span id="thought-text"></span></div>

    <!-- IMAGES -->
    <img id="screen_a1" class="conv-screen" src="https://i.imgur.com/XA7ud3Z.png">
    <img id="screen_a2" class="conv-screen" src="https://i.imgur.com/AW3Nnom.png">
    <img id="screen_a3" class="conv-screen" src="https://i.imgur.com/aValYxk.png">
    <img id="screen_b1" class="conv-screen" src="https://i.imgur.com/4zgNYwT.png">
    <img id="screen_c1" class="conv-screen" src="https://i.imgur.com/3One5eE.png">
    <img id="screen_c2" class="conv-screen" src="https://i.imgur.com/TU3SW7O.png">
    <img id="screen_d1" class="conv-screen" src="https://i.imgur.com/QBa0Hkv.png">
    <img id="screen_d2" class="conv-screen" src="https://i.imgur.com/DAcEnVA.png">
    <img id="screen_d3" class="conv-screen" src="https://i.imgur.com/sjenGQe.png">
    <img id="screen_e1" class="conv-screen" src="https://i.imgur.com/Ll5DcFY.png">
    <img id="screen_e2" class="conv-screen" src="https://i.imgur.com/Ug7Zv5N.png">
    <img id="screen_e3" class="conv-screen" src="https://i.imgur.com/4OMCAbt.png">

    <button id="end-button">Dormir</button>

    <script>

        /* ---------------- PLACEMENT GIFS TRANSPARENTS ---------------- */

        const gifURL = "https://i.imgur.com/6Y2yU7p.png";

        const gifPositions = [
            {x: "5%", y:"5%"},
            {x: "30%", y:"3%"},
            {x: "60%", y:"6%"},
            {x: "80%", y:"12%"},
            {x: "10%", y:"40%"},
            {x: "50%", y:"35%"},
            {x: "75%", y:"45%"},
            {x: "15%", y:"70%"},
            {x: "45%", y:"75%"},
            {x: "78%", y:"70%"}
        ];

        let floatingGifs = [];

        function createFloatingGifs() {
            removeFloatingGifs();

            for (let pos of gifPositions) {
                let g = document.createElement("img");
                g.src = gifURL;
                g.classList.add("floating-gif");
                g.style.left = pos.x;
                g.style.top = pos.y;
                document.body.appendChild(g);
                floatingGifs.push(g);
            }
        }

        function removeFloatingGifs() {
            floatingGifs.forEach(g => g.remove());
            floatingGifs = [];
        }

        /* ---------------- DIALOGUE SYSTEM ---------------- */

        const dialogueSequence = [
            { text: "Mais au fil du temps, Alice compris.", action: "dialogue" },
            { text: "Ce n'était pas quelqu'un comme les autres, il avais quelque chose d'unique en lui.", action: "dialogue" },
            { image: "screen_a1", action: "image" },
            { image: "screen_a2", action: "image" },
            { image: "screen_a3", action: "image" },
            { text: "Il s'intéressais vraiment à elle.", action: "dialogue" },
            { text: "Et il se souciais d'elle.", action: "dialogue" },
            { image: "screen_b1", action: "image" },
            { text: "Et il acceptais même ses conditions...", action: "dialogue" },
            { text: "Je rêve ou le narrateur viens de me juger là ?", action: "thought" },
            { image: "screen_c1", action: "image" },
            { image: "screen_c2", action: "image" },
            { text: "Petit à petit, Alice cessa d'être renfermée...", action: "dialogue" },
            { text: "(Nan mais ça vas pas ?!!)", action: "thought" },
            { text: "Ils partagèrent les mêmes passions.", action: "dialogue" },
            { image: "screen_d1", action: "image" },
            { image: "screen_d2", action: "image" },
            { image: "screen_d3", action: "image" },
            { text: "Puis un beau jour, elle cessa d'être seule.", action: "dialogue" },
            { image: "screen_e1", action: "image" },
            { image: "screen_e2", action: "image" },
            { image: "screen_e3", action: "image" },
            { action: "end" }
        ];

        let currentIndex = 0;
        let activeImage = null;

        const dialogueBox = document.getElementById("dialogue-box");
        const dialogueText = document.getElementById("dialogue-text");
        const thoughtBox = document.getElementById("thought-box");
        const thoughtText = document.getElementById("thought-text");
        const overlay = document.getElementById("intro-overlay-zone2");
        const endButton = document.getElementById("end-button");

        function hideImage(cb) {
            if (!activeImage) return cb();
            activeImage.style.opacity = 0;
            setTimeout(() => {
                activeImage.style.display = "none";
                activeImage = null;
                cb();
            }, 800);
        }

        function showImage(id) {
            hideImage(() => {
                createFloatingGifs();
                const img = document.getElementById(id);
                img.style.display = "block";
                activeImage = img;
                setTimeout(() => {
                    img.style.opacity = 1;
                    img.onclick = next;
                }, 40);
            });
        }

        function typeWriter(text, element, cb) {
            element.innerHTML = "";
            let i = 0;
            let inter = setInterval(() => {
                element.innerHTML += text[i];
                i++;
                if (i >= text.length) {
                    clearInterval(inter);
                    cb();
                }
            }, 25);
        }

        function showDialogue(text) {
            hideImage(() => {
                removeFloatingGifs();
                thoughtBox.style.display = "none";
                dialogueBox.style.display = "block";
                typeWriter(text, dialogueText, () => {
                    dialogueBox.onclick = next;
                });
            });
        }

        function showThought(text) {
            hideImage(() => {
                removeFloatingGifs();
                dialogueBox.style.display = "none";
                thoughtBox.style.display = "block";
                typeWriter(text, thoughtText, () => {
                    thoughtBox.onclick = next;
                });
            });
        }

        function next() {
            dialogueBox.style.display = "none";
            thoughtBox.style.display = "none";

            let step = dialogueSequence[currentIndex++];
            if (!step) return;

            if (step.action === "dialogue") return showDialogue(step.text);
            if (step.action === "thought") return showThought(step.text);
            if (step.action === "image") return showImage(step.image);

            if (step.action === "end") {
                hideImage(() => {
                    removeFloatingGifs();
                    endButton.style.display = "block";
                    endButton.onclick = () => {
                        window.location.href = "fin.html";
                    };
                });
            }
        }

        overlay.onclick = () => {
            overlay.style.display = "none";
            next();
        };

    </script>
</body>
</html>
