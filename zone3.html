<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zone 3 : C'est la merde</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body {
    margin: 0;
    overflow: hidden;
    font-family: 'Press Start 2P', cursive;
    background: black;
}

#intro-overlay-zone2 {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:black;
    z-index:7000;
    cursor:pointer;
}

.scene-img {
    position: fixed;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%);
    display:none;
    z-index:5000;
}

.glitch-gif {
    position: fixed;
    width: 250px;
    height: 250px;
    z-index:4000;
}

#final-button {
    position: fixed;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%);
    padding: 15px 30px;
    font-size: 1em;
    background: black;
    color: white;
    border: 3px solid white;
    cursor: pointer;
    z-index:6000;
    display:none;
    transition: opacity 0.5s;
}
</style>
</head>
<body>

<div id="intro-overlay-zone2"></div>

<img id="img5" class="scene-img" src="https://i.imgur.com/oBwbwxW.png">
<img id="img6" class="scene-img" src="https://i.imgur.com/kuEm3Fv.png">

<button id="final-button" onclick="window.location.href='fin.html'">Dormir</button>

<script>
/* ---------------------- VARIABLES ---------------------- */
let currentImageShown = null;
let usedPositions = [];
const GIF_SIZE = 250;
const MAX_GIFS = 10;

/* ---------------------- IMAGE ---------------------- */
function showImage(id) {
    hideAllImages();
    const img = document.getElementById(id);
    img.style.display = "block";
    currentImageShown = img;
}

function hideAllImages() {
    document.querySelectorAll(".scene-img").forEach(img => img.style.display = "none");
    currentImageShown = null;
}

/* ---------------------- DIALOGUE ---------------------- */
function typeWriter(text, element, callback, speed = 28) {
    element.innerHTML = '';
    let i = 0;
    const interval = setInterval(() => {
        element.innerHTML += text[i++];
        if (i >= text.length) {
            clearInterval(interval);
            if(callback) callback();
        }
    }, speed);
}

/* ---------------------- GLITCH ---------------------- */
function getRandomPosition() {
    const cols = Math.floor(window.innerWidth / GIF_SIZE);
    const rows = Math.floor(window.innerHeight / GIF_SIZE);
    let x, y, key, attempts = 0;
    do {
        const col = Math.floor(Math.random() * cols);
        const row = Math.floor(Math.random() * rows);
        x = col * GIF_SIZE;
        y = row * GIF_SIZE;
        key = `${col}-${row}`;
        attempts++;
        if (attempts > 100) return null;
    } while (usedPositions.includes(key));
    usedPositions.push(key);
    return {x, y};
}

function spawnGlitch(amount) {
    if (document.querySelectorAll(".glitch-gif").length === 0) usedPositions = [];
    const currentCount = document.querySelectorAll(".glitch-gif").length;
    const remaining = MAX_GIFS - currentCount;
    const toSpawn = Math.min(amount, remaining);
    for (let i=0;i<toSpawn;i++){
        const pos = getRandomPosition();
        if (!pos) break;
        const g = document.createElement("img");
        g.src = "https://i.imgur.com/UsrQHo8.gif";
        g.className = "glitch-gif";
        g.style.left = pos.x + "px";
        g.style.top = pos.y + "px";
        document.body.appendChild(g);
    }
}

function removeGlitch(all=false) {
    const gifs = [...document.querySelectorAll(".glitch-gif")];
    if(all){
        gifs.forEach(g=>g.remove());
        usedPositions = [];
    }else{
        const count = Math.floor(gifs.length * 0.5);
        gifs.sort(()=>Math.random()-0.5).slice(0,count).forEach(g=>g.remove());
    }
}

/* ---------------------- SEQUENCE ---------------------- */
const seq = [
    ()=>spawnGlitch(5),
    ()=>spawnGlitch(5),
    ()=>{document.body.style.backgroundImage = "url('https://neocardmaker.com/uploads/monthly_2019_10/1502293590_Spooky2.gif.aa0118140c56d49b8ecc4294d9e4bd34.gif')"; next();},
    ()=>showImage("img5"),
    ()=>removeGlitch(false),
    ()=>showImage("img6"),
    ()=>removeGlitch(true),
    ()=>{document.body.style.backgroundImage = "url('https://c.tenor.com/ZL7fgNaWWXMAAAAd/tenor.gif')"; next();},
    ()=>showFinalButton()
];

let seqIndex = 0;
function next(){
    if(seqIndex<seq.length){
        const f = seq[seqIndex];
        seqIndex++;
        f();
    }
}

/* ---------------------- BOUTON FINAL ---------------------- */
function showFinalButton(){
    hideAllImages();
    removeGlitch(true);
    const btn = document.getElementById("final-button");
    btn.style.opacity = 0;
    btn.style.display = "block";
    setTimeout(()=>btn.style.opacity=1,50);
}

/* ---------------------- LANCEMENT ---------------------- */
document.getElementById("intro-overlay-zone2").onclick = () => {
    document.getElementById("intro-overlay-zone2").style.display="none";
    next();
};
</script>

</body>
</html>
