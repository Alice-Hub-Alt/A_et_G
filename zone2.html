<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zone 2 : Le Labyrinthe de la Connexion</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  :root{
    --pink:#ff66ff;
    --pink-strong:#ff00ff;
  }

  html,body{
    height:100%;
    margin:0;
  }

  body{
    background-image: url('https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExd2tmam1wYzlkYzRpZzR3cmt3Mno4MGdrYmkwaDZpcmpzYTc5azdnNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/NANml9RASmTDU9tA5s/giphy.gif');
    background-size: cover;
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-position: center center;
    font-family: 'Press Start 2P', monospace;
    color: white;
    overflow:hidden;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:default;
  }

  #intro-overlay-zone2{
    position:fixed; inset:0;
    background:rgba(0,0,0,1);
    z-index:9999;
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--pink-strong);
    text-align:center;
    padding:20px;
    box-sizing:border-box;
    cursor:pointer;
    text-shadow:2px 2px 8px rgba(255,0,255,0.25);
  }

  #dialogue-box{
    position:fixed;
    left:50%;
    bottom:28px;
    transform:translateX(-50%);
    width:84%;
    min-height:14vh;
    max-height:30vh;
    background:rgba(0,0,0,0.56);
    border:3px solid var(--pink-strong);
    padding:18px;
    box-sizing:border-box;
    z-index:9000;
    color:var(--pink);
    display:none;
    text-shadow:0 0 6px rgba(255,0,255,0.2);
    overflow:auto;
  }

  #dialogue-text{ font-size:0.86em; line-height:1.45; }

  .cursor-active{
    border-right:0.15em solid var(--pink);
    animation:blink 0.5s steps(1) infinite;
    padding-right:6px;
  }

  @keyframes blink{
    0%,100%{ border-color:transparent }
    50%{ border-color:var(--pink) }
  }

  .clickable-door{
    position:absolute;
    height:200px;
    cursor:pointer;
    image-rendering:pixelated;
    transition:transform .18s;
    z-index:100;
    user-select:none;
  }

  .clickable-door:hover{ transform:scale(1.06); }

  #door-exit{
    left:50%;
    top:28%;
    transform:translateX(-50%);
    height:460px;
  }

  #door-1{ left:20%; top:5%; }
  #door-2{ left:10%; top:25%; }
  #door-3{ left:10%; top:50%; }
  #door-4{ left:20%; top:70%; }

  #door-5{ right:20%; top:5%; }
  #door-6{ right:10%; top:25%; }
  #door-7{ right:10%; top:50%; }
  #door-8{ right:20%; top:70%; }

  @media (max-height:700px){
    .clickable-door{ height:150px; }
    #door-exit{ height:360px; }
  }

  @media (max-width:600px){
    .clickable-door{ height:120px; }
    #door-exit{ height:300px; top:22%;}
    #dialogue-box{ width:92%; font-size:0.9rem; }
  }
</style>
</head>
<body>

<!-- AUDIO AMBIANT CORRIGÉ -->
<audio id="zone-audio" loop preload="auto">
  <source src="https://www.dropbox.com/scl/fi/ticd071iz11o9lv0kmaty/.mp3?raw=1" type="audio/mpeg">
</audio>

<audio id="type-sound" preload="auto"
  src="https://dl.dropboxusercontent.com/scl/fi/r88xcqkfq22gjne9usnea/phoenix-wright-talking-noise-made-with-Voicemod.mp3?raw=1">
</audio>

<div id="intro-overlay-zone2"><span id="overlay-text"></span></div>
<div id="dialogue-box"><div id="dialogue-text"></div></div>

<img id="door-exit" class="clickable-door" src="https://i.imgur.com/7xp8PkZ.png">
<img id="door-1" class="clickable-door" src="https://i.imgur.com/OSOCKnQ.png">
<img id="door-2" class="clickable-door" src="https://i.imgur.com/mTg0Zm6.png">
<img id="door-3" class="clickable-door" src="https://i.imgur.com/WKgSmFP.png">
<img id="door-4" class="clickable-door" src="https://i.imgur.com/HY94Buw.png">
<img id="door-5" class="clickable-door" src="https://i.imgur.com/gQgJFUN.png">
<img id="door-6" class="clickable-door" src="https://i.imgur.com/7vIHXUp.png">
<img id="door-7" class="clickable-door" src="https://i.imgur.com/qmbKHzv.png">
<img id="door-8" class="clickable-door" src="https://i.imgur.com/xzZ06bS.png">

<script>
const overlayText = "Hein..? Je suis où là ? Je suis dans ma tête c'est ça ? Pourquoi le narrateur est pas là ?!!!";
const initialDoorMessage = "Bon, on dirait que cette grande porte est la sortie";
const doorExitLocked = "La porte est verrouillée... on dirait un cadenas avec juste des flèches dessus.";
const genericDoorMessage = "Non, pas maintenant. C’est sûrement pas par là.";

let initialDoorMessageShown = false;

const overlay = document.getElementById('intro-overlay-zone2');
const overlayTextElement = document.getElementById('overlay-text');
const dialogueBox = document.getElementById('dialogue-box');
const dialogueTextElement = document.getElementById('dialogue-text');
const typeSound = document.getElementById('type-sound');
const zoneAudio = document.getElementById('zone-audio');

let isTyping = false;
let typingInterval = null;
let skipRequested = false;

function stopTypeSound(){
  try{
    typeSound.pause();
    typeSound.currentTime = 0;
  }catch(e){}
}

function typeWriter(text, target, onFinish){
  isTyping = true;
  target.innerHTML = "";
  target.classList.add('cursor-active');

  try{
    typeSound.currentTime = 0;
    typeSound.play().catch(()=>{});
  }catch(e){}

  let i = 0;
  typingInterval = setInterval(()=>{
    if(i < text.length){
      target.innerHTML += text.charAt(i++);
    }else{
      clearInterval(typingInterval);
      stopTypeSound();
      target.classList.remove('cursor-active');
      isTyping = false;
      if(onFinish) onFinish();
    }
  },28);
}

function typeWriterSilent(text, target, onFinish){
  target.innerHTML = "";
  let i = 0;
  const t = setInterval(()=>{
    if(i < text.length) target.innerHTML += text.charAt(i++);
    else{ clearInterval(t); if(onFinish) onFinish(); }
  },36);
}

function showMessage(msg, cb){
  if(isTyping) return;
  dialogueBox.style.display = "block";
  typeWriter(msg, dialogueTextElement, ()=>{
    dialogueBox.onclick = ()=>{
      dialogueBox.style.display = "none";
      stopTypeSound();
      if(cb) cb();
    };
  });
}

document.querySelectorAll('.clickable-door').forEach(d=>{
  if(d.id !== "door-exit"){
    d.onclick = ()=> showMessage(genericDoorMessage);
  }
});

document.getElementById('door-exit').onclick = ()=>{
  if(!initialDoorMessageShown){
    showMessage(initialDoorMessage, ()=> initialDoorMessageShown = true);
  }else{
    showMessage(doorExitLocked);
  }
};

function startScene(){
  typeWriterSilent(overlayText, overlayTextElement, ()=>{
    overlay.onclick = ()=>{
      overlay.style.opacity = 0;
      setTimeout(()=>{
        overlay.remove();
        zoneAudio.play().catch(()=>{});
        showMessage(initialDoorMessage, ()=> initialDoorMessageShown = true);
      },600);
    };
  });
}

startScene();
</script>

</body>
</html>
