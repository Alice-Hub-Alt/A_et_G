<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Porte 5</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Press Start 2P', monospace;
    overflow: hidden;
    background: url('https://i.imgur.com/tBDoGsY.gif') center/cover no-repeat;
    user-select: none;
}

#back-btn {
    position: fixed; top: 14px; left: 14px;
    font-size: 32px; color: red;
    cursor: pointer; z-index: 6000;
    text-shadow: 2px 2px 0px black;
}

#validate-btn {
    position: fixed; bottom: 10%; left: 50%;
    transform: translateX(-50%);
    padding: 15px 30px;
    font-family: 'Press Start 2P', monospace;
    background: black; color: white;
    border: 3px solid white;
    cursor: pointer;
    text-transform: uppercase;
    font-size: 1em;
    z-index: 50;
}

#dialogue-box {
    position: fixed; left: 50%; bottom: 20px;
    transform: translateX(-50%);
    width: 84%;
    min-height: 100px;
    background: rgba(0,0,0,0.9);
    border: 3px solid #ff00ff;
    padding: 18px;
    color: #ff66ff;
    display: none;
    z-index: 9000;
    font-size: 0.8em;
    line-height: 1.6;
}

#puzzle-container {
    position: fixed; top: 40%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 900px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 40px;
}

/* --- ZONE DE TEXTE --- */
#text-zone {
    background: rgba(0, 0, 0, 0.85);
    border: 4px solid white;
    padding: 35px;
    color: white;
    line-height: 2.8;
    font-size: 0.85em;
    text-align: left;
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.1);
}

.drop-zone {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    min-width: 100px;
    height: 32px;
    border-bottom: 3px solid #ff00ff;
    margin: 0 8px;
    color: #00ffff; /* Couleur différente pour les mots placés */
    cursor: pointer;
    transition: all 0.2s;
    vertical-align: middle;
}
.drop-zone:empty::before {
    content: "...";
    color: #555;
}

/* --- BANQUE DE MOTS --- */
#word-bank {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
}

.word-item {
    background: black;
    border: 2px solid white;
    padding: 8px 12px;
    color: white;
    cursor: grab;
    font-size: 0.65em;
    transition: transform 0.1s;
}
.word-item:hover { border-color: #ff00ff; color: #ff00ff; }
.word-item.dragging { opacity: 0.3; }
.word-item.used { display: none; } /* On cache le mot quand il est placé */

#win-image-container {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 5000;
    display: none;
}
#win-img { max-width: 90vw; max-height: 80vh; }

/* Animation d'erreur */
@keyframes shake {
    0%, 100% { transform: translate(-50%, -50%); }
    25% { transform: translate(-52%, -50%); }
    75% { transform: translate(-48%, -50%); }
}
.shake { animation: shake 0.2s ease-in-out 0s 2; }

</style>
</head>
<body>

<audio id="type-sound" src="https://dl.dropboxusercontent.com/scl/fi/r88xcqkfq22gjne9usnea/phoenix-wright-talking-noise-made-with-Voicemod.mp3?rlkey=cuykwz6lmg1wa21zl0aqljobh&dl=0"></audio>

<div id="back-btn" onclick="history.back()">⬅</div>

<div id="puzzle-container">
    <div id="text-zone">
        Je me demande qui je suis. D'un coté j'ai l'impression d'être très 
        <div class="drop-zone" data-answer="intelligente"></div>, mais quand je réfléchis deux minutes je me dit que je suis surtout très 
        <div class="drop-zone" data-answer="bizarre"></div>. Oui je sais que c'est très 
        <div class="drop-zone" data-answer="orgueilleux"></div> de me croire 
        <div class="drop-zone" data-answer="différente"></div>. Mais bon au final, il suffit d'
        <div class="drop-zone" data-answer="ignorer"></div> tout cela. Je n'ai jamais cru en la valeur de 
        <div class="drop-zone" data-answer="la vérité"></div> de toute façon. Autant juste 
        <div class="drop-zone" data-answer="vivre"></div> une 
        <div class="drop-zone" data-answer="illusion"></div> qui nous rend heureux plutôt que de  
        <div class="drop-zone" data-answer="rechercher"></div> quelque chose qui n'existe pas, ou nous rendra malheureux. Non ?
    </div>

    <div id="word-bank">
        <div class="word-item" draggable="true">intelligente</div>
        <div class="word-item" draggable="true">bizarre</div>
        <div class="word-item" draggable="true">orgueilleux</div>
        <div class="word-item" draggable="true">différente</div>
        <div class="word-item" draggable="true">ignorer</div>
        <div class="word-item" draggable="true">la vérité</div>
        <div class="word-item" draggable="true">vivre</div>
        <div class="word-item" draggable="true">illusion</div>
        <div class="word-item" draggable="true">rechercher</div>
        <div class="word-item" draggable="true">supérieure</div>
        <div class="word-item" draggable="true">bête</div>
        <div class="word-item" draggable="true">abandonner</div>
        <div class="word-item" draggable="true">valeur absolue</div>
        <div class="word-item" draggable="true">accepter</div>
        <div class="word-item" draggable="true">réalité</div>
        <div class="word-item" draggable="true">poursuivre</div>
        <div class="word-item" draggable="true">lucide</div>
        <div class="word-item" draggable="true">banale</div>
        <div class="word-item" draggable="true">existence</div>
        <div class="word-item" draggable="true">simuler</div>
    </div>
</div>

<button id="validate-btn">VALIDER</button>

<div id="win-image-container">
    <img id="win-img" src="https://i.imgur.com/ypjtAil.png" alt="Victoire">
</div>

<div id="dialogue-box"></div>

<script>
const dialogueBox = document.getElementById("dialogue-box");
const typeSound = document.getElementById("type-sound");
let typeInterval;

const dialogs = {
    intro: ["Bah tient encore une bibliothèque !", "C'est censé être mes pensées ça ? Mais c'est absolument pas complet !"],
    win: "Bon, OK je pense ça mais tout de même, le voir écrire c'est un peu gênant...",
    fail: "Nan je suis encore pire que ça !"
};

function playSound() {
    try { typeSound.currentTime = 0; typeSound.play().catch(()=>{}); } catch(e){}
}

function showDialogue(text, callback = null) {
    clearInterval(typeInterval);
    dialogueBox.style.display = 'block';
    dialogueBox.innerHTML = '';
    playSound();
    let i = 0;
    let currentText = "";
    dialogueBox.onclick = () => {
        clearInterval(typeInterval);
        dialogueBox.innerHTML = text;
        finish();
    };
    function finish() {
        try { typeSound.pause(); } catch(e){}
        dialogueBox.onclick = () => {
            dialogueBox.style.display = 'none';
            if (callback) callback();
        };
    }
    typeInterval = setInterval(() => {
        currentText += text.charAt(i);
        dialogueBox.innerHTML = currentText;
        i++;
        if (i >= text.length) { clearInterval(typeInterval); finish(); }
    }, 30);
}

// --- LOGIQUE DRAG & DROP ---
let draggedWord = null;
const words = document.querySelectorAll('.word-item');
const zones = document.querySelectorAll('.drop-zone');

words.forEach(word => {
    word.addEventListener('dragstart', () => {
        draggedWord = word;
        word.classList.add('dragging');
    });
    word.addEventListener('dragend', () => word.classList.remove('dragging'));
});

zones.forEach(zone => {
    zone.addEventListener('dragover', e => e.preventDefault());
    zone.addEventListener('drop', () => {
        if (draggedWord) {
            // Si la zone est déjà pleine, on libère l'ancien mot
            if (zone.innerText !== "") {
                const oldWordText = zone.innerText;
                words.forEach(w => { if(w.innerText === oldWordText) w.classList.remove('used'); });
            }
            zone.innerText = draggedWord.innerText;
            draggedWord.classList.add('used');
            draggedWord = null;
        }
    });

    // RETIRER UN MOT EN CLIQUANT DESSUS
    zone.onclick = () => {
        if (zone.innerText !== "") {
            const wordToReturn = zone.innerText;
            words.forEach(w => { if(w.innerText === wordToReturn) w.classList.remove('used'); });
            zone.innerText = "";
        }
    };
});

window.onload = () => {
    // Mélange aléatoire des mots dans la banque
    const bank = document.getElementById('word-bank');
    for (let i = bank.children.length; i >= 0; i--) {
        bank.appendChild(bank.children[Math.random() * i | 0]);
    }
    
    showDialogue(dialogs.intro[0], () => {
        setTimeout(() => showDialogue(dialogs.intro[1]), 200);
    });
};

document.getElementById('validate-btn').onclick = () => {
    let allCorrect = true;
    zones.forEach(zone => {
        if (zone.innerText.trim() !== zone.dataset.answer) {
            allCorrect = false;
        }
    });

    if (allCorrect) {
        document.getElementById('puzzle-container').style.display = 'none';
        document.getElementById('validate-btn').style.display = 'none';
        document.getElementById('win-image-container').style.display = 'block';
        showDialogue(dialogs.win);
    } else {
        const container = document.getElementById('puzzle-container');
        container.classList.add('shake');
        setTimeout(() => container.classList.remove('shake'), 400);
        showDialogue(dialogs.fail);
        
        // Optionnel : Réinitialiser tout si tu veux être dure avec lui
        /*
        zones.forEach(zone => zone.innerText = "");
        words.forEach(w => w.classList.remove('used'));
        */
    }
};
</script>
</body>
</html>
